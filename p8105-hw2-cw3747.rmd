---
title: "p8105-hw2-cw3747"
author: "chuhan wang_cw3747"
date: "2025-09-24"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Problem 1.1
```{r}
library(tidyverse)
pols = read_csv("./538_datasets/pols-month.csv")
```

```{r}
pols = pols |>
  separate(mon, c("year", "month", "day"), sep = "-") |>
  mutate(month = month.abb[as.numeric(month)]) |>
  mutate(president = case_when(
    prez_dem == 1 ~ "dem",
    prez_gop == 1 ~ "gop"
  )) |>
  select(-prez_gop, -prez_dem, -day)
```

## Problem 1.2
```{r}
snp = read_csv("./538_datasets/snp.csv") |>
  separate(date, c("month", "date", "year"), sep = "/") |>
  mutate(
    month = factor(month.abb[as.integer(month)], levels = month.abb, ordered = TRUE),
    year = as.numeric(year),
    year = ifelse(year < 100, ifelse(year >= 50, 1900 + year, 2000 + year), year)
    ) |>
  select(year, month, close) |>
  arrange(year, month)
```

## Problem 1.3
```{r}
unemp = read_csv("./538_datasets/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(
    month = factor(month, levels = month.abb, ordered = TRUE),
    year = as.numeric(year)
    ) |>
  arrange(year, month)
```

## Problem 1.4
```{r}
pols = pols |>
  mutate(
    year = as.integer(year),
    month = as.character(month))

snp = snp |>
  mutate(
    year = as.integer(year),
    month = as.character(month))

unemp = unemp |>
  mutate(
    year = as.integer(year),
    month = as.character(month))
```

```{r}
pols_merged = pols |>
  left_join(snp, by = c("year", "month")) |>
  left_join(unemp, by = c("year", "month"))
```

## Description
The pols-moth dataset presents the political composition of the U.S. government, including counts of Democratic and Republican governors, senators, and representatives, along with the president’s party from January 1947 to June 2015.The snp dataset provides monthly closing values of the Standard & Poor’s stock index, reflecting stock market performance over time from January 1950 to June 2015. And the unemployment dataset shows monthly unemployment rates from 1948 through 2015. The resulting dataset spans roughly 1950 to mid-2015. It combines political composition, stock market performance, and unemployment trends into one frame, with key variables including year, month, president, governors, senators, representatives, close (S&P index), and unemployment rate. This integrated dataset allows examination of relationships between political context, economic indicators, and labor market conditions.

## Problem 2
### Mr. Trash Wheel
```{r}
library(tidyverse)
library(readxl)
library(janitor)
library(lubridate)

Mr_data = read_excel("./202409 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  select(where(~ !all(is.na(.x)))) |>
  filter(!is.na(dumpster)) |>
  mutate(sports_balls = as.integer(round(sports_balls))) |>
  filter(!is.na(date), !is.na(year), !is.na(month))
```

### Combination
```{r}
Pf_data = read_excel("./202409 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  select(where(~ !all(is.na(.x)))) |>
  filter(!is.na(dumpster)) |>
  filter(!is.na(date), !is.na(year), !is.na(month))
  
Gwy_data = read_excel("./202409 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  select(where(~ !all(is.na(.x)))) |>
  filter(!is.na(dumpster)) |>
  filter(!is.na(date), !is.na(year), !is.na(month))
```

```{r}
Mr_data = Mr_data |>
  mutate(date = lubridate::as_date(date),
         month = lubridate::month(date, abbr = TRUE, label = TRUE),
         year = lubridate::year(date),
         source = "Mr"
         )
Pf_data = Pf_data |>
  mutate(date = lubridate::as_date(date),
         month = lubridate::month(date, abbr = TRUE, label = TRUE),
         year = lubridate::year(date),
         source = "Pf"
         )
Gwy_data = Gwy_data |>
  mutate(date = lubridate::as_date(date),
         month = lubridate::month(date, abbr = TRUE, label = TRUE),
         year = lubridate::year(date),
         source = "Gwy"
         )

twc_all = dplyr::bind_rows(Mr_data, Pf_data, Gwy_data) |>
  dplyr::arrange(date, source, dumpster)

```

### Description
```{r}
library(scales)
n_obs  <- nrow(twc_all)
yr_rng <- range(twc_all$year, na.rm = TRUE)

prof_total_weight_tons = Pf_data |>
  summarise(total = sum(weight_tons, na.rm = TRUE)) |>
  pull(total)

gw_cigs_june_2022 <- Gwy_data |>
  filter(year(date) == 2022, month(date, label = TRUE, abbr = TRUE) == "Jun") |>
  summarise(total = sum(cigarette_butts, na.rm = TRUE)) |>
  pull(total)
```
I imported and cleaned the Mr/Professor/Gwynnda Trash Wheel sheets, removed non-data rows (e.g., notes/totals), used clean variable names, rounded sports_balls to the nearest integer, and added a source indicator before stacking the tables. After removing missing values (NA), the resulting tidy dataset contains **`r n_obs`** observations spanning **`r yr_rng[1]`–`r yr_rng[2]`**. Key variables include dumpster, date, weight (tons), volume (cubic yards), and item counts such as plastic_bottles, polystyrene, cigarette_butts, plastic_bags, wrappers, sports_balls (Mr only), and homes_powered. Using the available data, the total weight collected by Professor Trash Wheel is **`r round(prof_total_weight_tons, 2)`** tons, and Gwynnda collected **`r gw_cigs_june_2022`** cigarette butts in June 2022.

## Problem3
### clean and combine
```{r}
library(tidyverse)
zip_info = read_csv("./zillow_data/Zip Codes.csv")
zillow_data = read_csv("./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")
```

```{r}
zip_info = zip_info |>
  janitor::clean_names() |>
  mutate(zip_code = as.character(zip_code))
```

```{r}
zillow_data = zillow_data |>
  janitor::clean_names() |>
  rename(zip_code = region_name) |>
  mutate(zip_code = as.character(zip_code))
```

```{r}
zillow_data = zillow_data |>
  pivot_longer(
    cols = starts_with("x20"),
    names_to = "date",
    values_to = "rent_price"
  ) |>
   mutate(
    date = as.Date(str_replace_all(str_remove(date, "x"), "_", "-")),
    .keep = "unused")
```



