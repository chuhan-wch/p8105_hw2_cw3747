p8105-hw2-cw3747
================
chuhan wang_cw3747
2025-09-24

## Problem 1.1

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
pols = read_csv("./538_datasets/pols-month.csv")
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
pols = pols |>
  separate(mon, c("year", "month", "day"), sep = "-") |>
  mutate(month = month.abb[as.numeric(month)]) |>
  mutate(president = case_when(
    prez_dem == 1 ~ "dem",
    prez_gop == 1 ~ "gop"
  )) |>
  select(-prez_gop, -prez_dem, -day)
```

## Problem 1.2

``` r
snp = read_csv("./538_datasets/snp.csv") |>
  separate(date, c("month", "date", "year"), sep = "/") |>
  mutate(
    month = factor(month.abb[as.integer(month)], levels = month.abb, ordered = TRUE),
    year = as.numeric(year),
    year = ifelse(year < 100, ifelse(year >= 50, 1900 + year, 2000 + year), year)
    ) |>
  select(year, month, close) |>
  arrange(year, month)
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## Problem 1.3

``` r
unemp = read_csv("./538_datasets/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    cols = Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(
    month = factor(month, levels = month.abb, ordered = TRUE),
    year = as.numeric(year)
    ) |>
  arrange(year, month)
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## Problem 1.4

``` r
pols = pols |>
  mutate(
    year = as.integer(year),
    month = as.character(month))

snp = snp |>
  mutate(
    year = as.integer(year),
    month = as.character(month))

unemp = unemp |>
  mutate(
    year = as.integer(year),
    month = as.character(month))
```

``` r
pols_merged = pols |>
  left_join(snp, by = c("year", "month")) |>
  left_join(unemp, by = c("year", "month"))
```

## Description

The pols-moth dataset presents the political composition of the U.S.
government, including counts of Democratic and Republican governors,
senators, and representatives, along with the president’s party from
January 1947 to June 2015.The snp dataset provides monthly closing
values of the Standard & Poor’s stock index, reflecting stock market
performance over time from January 1950 to June 2015. And the
unemployment dataset shows monthly unemployment rates from 1948 through
2015. The resulting dataset spans roughly 1950 to mid-2015. It combines
political composition, stock market performance, and unemployment trends
into one frame, with key variables including year, month, president,
governors, senators, representatives, close (S&P index), and
unemployment rate. This integrated dataset allows examination of
relationships between political context, economic indicators, and labor
market conditions.

## Problem 2

### Mr. Trash Wheel

``` r
library(tidyverse)
library(readxl)
library(janitor)
```

    ## 
    ## Attaching package: 'janitor'

    ## The following objects are masked from 'package:stats':
    ## 
    ##     chisq.test, fisher.test

``` r
library(lubridate)

Mr_data = read_excel("./202409 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  select(where(~ !all(is.na(.x)))) |>
  filter(!is.na(dumpster)) |>
  mutate(sports_balls = as.integer(round(sports_balls))) |>
  filter(!is.na(date), !is.na(year), !is.na(month))
```

    ## New names:
    ## • `` -> `...15`
    ## • `` -> `...16`

### Combination

``` r
Pf_data = read_excel("./202409 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  select(where(~ !all(is.na(.x)))) |>
  filter(!is.na(dumpster)) |>
  filter(!is.na(date), !is.na(year), !is.na(month))
  
Gwy_data = read_excel("./202409 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", skip = 1) |>
  janitor::clean_names() |>
  select(where(~ !all(is.na(.x)))) |>
  filter(!is.na(dumpster)) |>
  filter(!is.na(date), !is.na(year), !is.na(month))
```

``` r
Mr_data = Mr_data |>
  mutate(date = lubridate::as_date(date),
         month = lubridate::month(date, abbr = TRUE, label = TRUE),
         year = lubridate::year(date),
         source = "Mr"
         )
Pf_data = Pf_data |>
  mutate(date = lubridate::as_date(date),
         month = lubridate::month(date, abbr = TRUE, label = TRUE),
         year = lubridate::year(date),
         source = "Pf"
         )
Gwy_data = Gwy_data |>
  mutate(date = lubridate::as_date(date),
         month = lubridate::month(date, abbr = TRUE, label = TRUE),
         year = lubridate::year(date),
         source = "Gwy"
         )

twc_all = dplyr::bind_rows(Mr_data, Pf_data, Gwy_data) |>
  dplyr::arrange(date, source, dumpster)
```

### Description

``` r
library(scales)
```

    ## 
    ## Attaching package: 'scales'

    ## The following object is masked from 'package:purrr':
    ## 
    ##     discard

    ## The following object is masked from 'package:readr':
    ## 
    ##     col_factor

``` r
n_obs  <- nrow(twc_all)
yr_rng <- range(twc_all$year, na.rm = TRUE)

prof_total_weight_tons = Pf_data |>
  summarise(total = sum(weight_tons, na.rm = TRUE)) |>
  pull(total)

gw_cigs_june_2022 <- Gwy_data |>
  filter(year(date) == 2022, month(date, label = TRUE, abbr = TRUE) == "Jun") |>
  summarise(total = sum(cigarette_butts, na.rm = TRUE)) |>
  pull(total)
```

I imported and cleaned the Mr/Professor/Gwynnda Trash Wheel sheets,
removed non-data rows (e.g., notes/totals), used clean variable names,
rounded sports_balls to the nearest integer, and added a source
indicator before stacking the tables. After removing missing values
(NA), the resulting tidy dataset contains **1032** observations spanning
**2014–2024**. Key variables include dumpster, date, weight (tons),
volume (cubic yards), and item counts such as plastic_bottles,
polystyrene, cigarette_butts, plastic_bags, wrappers, sports_balls (Mr
only), and homes_powered. Using the available data, the total weight
collected by Professor Trash Wheel is **246.74** tons, and Gwynnda
collected **1.812^{4}** cigarette butts in June 2022.

## Problem3

### clean and combine

``` r
library(tidyverse)
zip_info = read_csv("./zillow_data/Zip Codes.csv")
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zillow_data = read_csv("./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zip_info = zip_info |>
  janitor::clean_names() |>
  mutate(zip_code = as.character(zip_code))
```

``` r
zillow_data = zillow_data |>
  janitor::clean_names() |>
  rename(zip_code = region_name) |>
  mutate(zip_code = as.character(zip_code))
```

``` r
zillow_data = zillow_data |>
  pivot_longer(
    cols = starts_with("x20"),
    names_to = "date",
    values_to = "rent_price"
  ) |>
   mutate(
    date = as.Date(str_replace_all(str_remove(date, "x"), "_", "-")),
    .keep = "unused")
```

``` r
ny_rent = zillow_data |>
  left_join(zip_info, by = "zip_code") |>
  arrange(zip_code, date)
```

    ## Warning in left_join(zillow_data, zip_info, by = "zip_code"): Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 4757 of `x` matches multiple rows in `y`.
    ## ℹ Row 256 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

### Problem 3.1

``` r
ny_rent_unique <- ny_rent |>
  distinct(zip_code, date, .keep_all = TRUE)

zip_geo_unique <- ny_rent |>
  distinct(zip_code, county, neighborhood)

n_obs  <- nrow(ny_rent_unique)
n_zip  <- dplyr::n_distinct(ny_rent_unique$zip_code)
n_nbhd <- dplyr::n_distinct(zip_geo_unique$neighborhood, na.rm = TRUE)
```

When merging, some ZIP codes appeared in multiple boroughs (e.g., 10463
in both Bronx and Manhattan). To avoid artificial inflation of the
number of observations due to many-to-many matches, I retained one
unique mapping per ZIP code. This ensures each zipcode has a single
geographic identifier while preserving the full rental time series from
Zillow. The resulting tidy dataset contains **17,284** observations
across **149** unique ZIP codes and **42** neighborhoods.

### Problem 3.2

``` r
zips_info   <- unique(zip_info$zip_code)
zips_zillow <- unique(zillow_data$zip_code)
missing_zips <- setdiff(zips_info, zips_zillow)
```

There are **171** ZIP codes that appear in the ZIP code dataset but not
in the Zillow rental dataset, e.g., **10464, 10474, 10475, 10499,
10550**. This may occur for several reasons: A.During certain periods,
there may have been no available rental units in those ZIP codes; B.Some
ZIP codes correspond mainly to business or industrial districts, which
are not typically included in Zillow’s rental database; C.Zillow may not
have updated its coverage promptly for certain ZIP codes.
